# HotelA95 WhatsApp Bot

Бот для автоматизации бронирования апартаментов через WhatsApp.

## Функциональность

- Автоматические ответы клиентам через WhatsApp
- Поиск и бронирование свободных квартир
- Автоматическая проверка оплаты через Kaspi
- API для управления бронированиями
- Интеграция с OpenAI GPT для обработки сообщений

## Требования

- Node.js 18+
- MongoDB
- Доступ к WhatsApp Web

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/your-username/hotelA95.git
   cd hotelA95
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```

4. Отредактируйте файл `.env` и укажите необходимые параметры

5. Запустите приложение:
   ```bash
   npm start
   ```

## Структура проекта

```
src/
├── config/         # Конфигурационные файлы 
├── const/          # Константы и шаблоны сообщений
├── controllers/    # Контроллеры обработки сообщений
├── models/         # Модели данных Mongoose
├── routes/         # API маршруты
├── scripts/        # Вспомогательные скрипты
├── services/       # Бизнес-логика
├── utils/          # Утилиты
└── index.js        # Точка входа в приложение
```

## Использование

При первом запуске будет сгенерирован QR-код, который нужно отсканировать в приложении WhatsApp для аутентификации бота.

## API

### Отправка сообщения

```
POST /api/clientNumber
{ "phone": "+7XXXXXXXXXX", "message": "Текст сообщения" }
```

### Получение информации о пользователе

```
GET /api/users/:phone
```

## Последние изменения

- Проведён полный рефакторинг кода с улучшением структуры проекта
- Оптимизированы запросы к API для бронирования и оплаты
- Обновлены механизмы проверки платежей Kaspi
- Улучшена обработка ошибок и логирование
- Удалены устаревшие скрипты и неиспользуемые модули

## Устранение неполадок

### Ошибка 'Error: listen EADDRINUSE: address already in use'
Порт, указанный в .env, уже используется другим приложением. Измените значение PORT в файле .env.

### Ошибка 'Error: Cannot find module'
Некоторые модули могли быть не перенесены в правильные места при рефакторинге. Убедитесь, что все необходимые файлы скопированы в директорию src/.

### Проблемы с аутентификацией WhatsApp
Если возникают проблемы с подключением к WhatsApp Web, попробуйте удалить директорию .wwebjs_auth/ и перезапустить приложение для новой аутентификации. 